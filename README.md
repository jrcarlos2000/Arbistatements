using semaphore protocol as a starting point
